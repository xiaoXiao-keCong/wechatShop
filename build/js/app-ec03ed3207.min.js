/**
 * Created by hugotan on 2016/4/16.
 */
angular.module('addReceiver', []).controller('addReceiverCtrl', ['$scope', '$http', function ($scope, $http) {
	var transFn = function(data) {
                return $.param(data);
        },
        postCfg = {
            headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
            transformRequest: transFn
        };
	$scope.save = function () {
		var data = {
			name: $scope.name,
			telephone: $scope.phone,
			city: $scope.city,
			address: $scope.address
		};
		var promise = $http.post('/user/addaddress.json', data, postCfg);
		promise.then(function (resp) {
			console.log(resp);
		}, function (resp) {
			console.log(resp);
		});
	};
}]);
/**
 * Created by hugotan on 2016/4/12.
 */
angular.module('addrManage', []).controller('addrManageCtrl', ['$scope', '$http', '$window',
    function ($scope, $http, $window) {
    var transFn = function(data) {
                return $.param(data);
        },
        postCfg = {
            headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
            transformRequest: transFn
        };

    // 获取用户收货地址
    $http.post('/user/myaddress.json', postCfg)
        .success(function (data) {
            if (1 === data.code && 0 < data.data.addresslist.length) {
                $scope.addrList = data.data.addresslist;
            }
        })
        .error(function (resp) {
            console.log(resp);
        }
    );

    $scope.checkDefault = function (addr) {
        if (1 === addr.defaultflag) {
            return true;
        }
        return false;
    };
    // 跳转到新建地址页面
    $scope.toAddAddr = function () {
        $window.location.href = 'add_receiver.html';
    };
}]);
/**
 * Created by hugotan on 2016/4/12.
 */
angular.module('address', []).controller('addressCtrl', ['$scope', '$http', function ($scope, $http) {
    var transFn = function(data) {
                return $.param(data);
        },
        postCfg = {
            headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
            transformRequest: transFn
        };
    // 获取用户收货地址
    $http.post('/user/myaddress.json', postCfg)
        .success(function (data) {
            if (1 === data.code && 0 < data.data.addresslist.length) {
                $scope.addrList = data.data.addresslist;
            }
        })
        .error(function (resp) {
            console.log(resp);
        }
    );
    $scope.checkIsDefault = function (addr) {
        return 1 == addr.defaultflag ? true : false;
    };

}]);
/**
 * Created by hugotan on 2016/4/16.
 */
angular.module('balance', []).controller('balanceCtrl', ['$scope', '$http', function ($scope, $http) {
	var transFn = function(data) {
                return $.param(data);
        },
        postCfg = {
            headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
            transformRequest: transFn
        },
        picBaseUrl = 'http://photo.yueyishujia.com:8112';
	var cartPromise = $http.post('/user/mybalancerecord.json', postCfg);
	cartPromise.then(function (resp) {
		var data = resp.data;
		console.log(data);
		if (1 === data.code && 0 < data.data.balancelist.length) {
			$scope.balanceList = data.data.balancelist;
		}
	}, function (resp) {
		console.log(resp);
	});
}]);
/**
 * Created by hugotan on 2016/4/16.
 */
angular.module('cart', []).controller('cartCtrl', ['$scope', '$http', function ($scope, $http) {
	var transFn = function(data) {
                return $.param(data);
        },
        postCfg = {
            headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
            transformRequest: transFn
        },
        picBaseUrl = 'http://photo.yueyishujia.com:8112';
	var cartPromise = $http.post('/user/mycart.json', postCfg);
	cartPromise.then(function (resp) {
		var data = resp.data;
		if (1 === data.code && 0 < data.data.cartlist.length) {
			var cartList = data.data.cartlist;
			for (var i =0, j  = cartList.length; i < j; i++) {
				cartList[i].goods.imgurl = picBaseUrl + cartList[i].goods.imgurl1;
			}
			$scope.cartList = cartList;
			console.log(cartList);

		}
	}, function (resp) {
		console.log(resp);
	});
}]);
/**
 * Created by hugotan on 2016/4/11.
 */
angular.module('collection', []).controller('collectionCtrl', ['$scope', '$http', function ($scope, $http) {

	var picBaseUrl = 'http://photo.yueyishujia.com:8112';
	var transFn = function(data) {
                return $.param(data);
        },
        postCfg = {
            headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
            transformRequest: transFn
        };

    $scope.isDesigner = true; 
    var designerPromise = $http.post('/user/mykeepdesigner.json', postCfg);
    designerPromise.then(function (resp) {
    	var designerList = resp.data.data.designerlist;
    	// 对图片地址添加前缀
    	for (var i = 0, j = designerList.length; i < j; i++) {
    		designerList[i].imgurl = picBaseUrl + designerList[i].imgurl;
    	}
    	$scope.designerList = designerList;
    	console.log(designerList);
    }, function (resp) {
    	console.log(resp);
    });
}]);
/**
 * Created by hugotan on 2016/4/9.
 */
angular.module('completeInfo', []).controller('completeInfoCtrl', ['$scope', function ($scope) {

}]);

/**
 * Created by hugotan on 2016/4/16.
 */
angular.module('coupon', []).controller('couponCtrl', ['$scope', '$http', function ($scope, $http) {
    var transFn = function(data) {
                return $.param(data);
        },
        postCfg = {
            headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
            transformRequest: transFn
        };
    $scope.unused = true;
    $scope.used = false;
    $scope.expired = false;

    var couponPromise = $http.post('/user/mycouponlist.json', postCfg);
    couponPromise.then(function (resp) {
    	if (1 === resp.data.code) {
    		var data = resp.data.data;
    		$scope.unusedList = addTypePic(data.unUsed);
    		$scope.noUnused = (0 === $scope.unusedList.length ? true : false);
    		$scope.usedList = addTypePic(data.used, true);
    		$scope.noUsed = (0 === $scope.usedList.length ? true : false);
    		$scope.expiredList = addTypePic(data.overdue, true);
    		$scope.noExpired = (0 === $scope.expiredList.length ? true : false);
    	}
    }, function (resp) {
    	console.log(resp);
    });

    // 判断优惠券类型：0全品类、1商品类、2服务品类
    function addTypePic(couponList, isUsed) {
    	var picRelativePath = '../../assets/images/',
    	    typePrefix = '此代金券可用于';
    	for (var i = 0, j = couponList.length; i < j; i++) {
    		var coupon = couponList[i];
    		switch(coupon.type) {
    			case 1:
    				couponList[i].typeText = typePrefix + '全部分类';
    				couponList[i].typePic = picRelativePath + (isUsed ? 'quan_grey.png' : 'quan.png');
    				break;
				case 2:
					couponList[i].typeText = typePrefix + '商品类';
					couponList[i].typePic = picRelativePath + (isUsed ? 'shang_grey.png' : 'shang.png');
					break;
				case 3:
					couponList[i].typeText = typePrefix + '服务品类';
					couponList[i].typePic = picRelativePath + (isUsed ? 'fu_grey.png' : 'fu.png');
    		}
    	}
    	return couponList;
    }
    $scope.selectCoupon = function (index) {
    	$scope.unused = (1 === index ? true : false);
    	$scope.used = (2 === index ? true : false);
    	$scope.expired = (3 === index ? true : false);
    };
}]);
/**
 * Created by hugotan on 2016/4/9.
 */
angular.module('fastLogin', []).controller('fastLoginCtrl', ['$scope', function ($scope) {

}]);
/**
 * Created by hugotan on 2016/4/16.
 */
angular.module('feedback', []).controller('feedbackCtrl', ['$scope', '$http', function ($scope, $http) {
    var transFn = function(data) {
                return $.param(data);
        },
        postCfg = {
            headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
            transformRequest: transFn
        };

    // 监听值的变化并改变提交按钮的样式
    $scope.$watch('feedback', function (newValue, oldValue, scope) {
        // 去除前后空格
        if ('undefined' === typeof(newValue) ||
            '' === newValue.replace(/(^\s*)|(\s*$)/g, '')) {
            $scope.isFeedbackEmpty = true;
        }
        else {
            $scope.isFeedbackEmpty = false;
        }
    });
    // var couponPromise = $http.post('/user/mycouponlist.json', postCfg);
    $scope.submitFeedback = function () {
        var feedbackText = $scope.feedback.replace(/(^\s*)|(\s*$)/g, ''),
            data = {
                content: feedbackText
            };
        var feedbackPromise = $http.post('/user/feedback.json', data, postCfg);
        feedbackPromise.then(function (resp) {
            if (1 === resp.data.code) {
                alert('提交成功');
            }
        }, function (resp) {
            console.log(resp);
        });
    };
}]);
/**
 * Created by hugotan on 2016/4/10.
 */
angular.module('forgetPwd', []).controller('forgetPwdCtrl', ['$scope', function ($scope) {

}]);
/**
 * Created by hugotan on 2016/4/11.
 */
var index = angular.module('index', ['ngRoute']);
// 首页路由
index.config(['$routeProvider', function ($routeProvider) {
	
}]);
/**
 * Created by hugotan on 2016/4/10.
 */
angular.module('login', []).controller('loginCtrl', ['$scope', '$http', function ($scope, $http) {
    $scope.login = function () {
        var test = '123456';
        // 用账号密码都为123进行测试
        var data = {account: '123', password: '123'},
            transFn = function(data) {
                return $.param(data);
            },
            postCfg = {
                headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
                transformRequest: transFn
            };
        var loginPromise = $http.post('/user/login.json', data, postCfg);
        loginPromise.then(function (resp) {
            console.log(resp);
        }, function (resp) {
            console.log(resp);
        });
    };
}]);
/**
 * Created by hugotan on 2016/4/23.
 */
 var transFn = function(data) {
        return $.param(data);
    },
    postCfg = {
        headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
        transformRequest: transFn
    };
var pay = angular.module('pay', ['ngRoute']);
// 支付界面路由
pay.config(['$routeProvider', function ($routeProvider) {
	$routeProvider
		.when('/', {
			templateUrl: '../html/pay_recharge.html',
			controller: 'payRechargeCtrl'
		})
		.when('/pay_goods', {
			templateUrl: '../html/pay_goods.html',
			controller: 'payGoodsCtrl'
		});
}]);
// 充值支付控制器
pay.controller('payRechargeCtrl', ['$scope', '$http', function ($scope, $http) {

}]);
// 商品支付控制器
pay.controller('payGoodsCtrl', ['$scope', '$http', function ($scope, $http) {

}]);
/**
 * Created by hugotan on 2016/4/10.
 */
angular.module('recharge', []).controller('rechargeCtrl', ['$scope', '$http', function ($scope, $http) {
    var transFn = function(data) {
            return $.param(data);
        },
        postCfg = {
            headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'},
            transformRequest: transFn
        };

}]);
/**
 * Created by hugotan on 2016/4/9.
 */
angular.module('register', []).controller('registerCtrl', ['$scope', function ($scope, $http) {
    var baseUrl = 'http://api.yueyishujia.com:8888';
}]);
/**
 * Created by hugotan on 2016/4/9.
 */
angular.module('setting', []).controller('settingCtrl', ['$scope', function ($scope) {

}]);
